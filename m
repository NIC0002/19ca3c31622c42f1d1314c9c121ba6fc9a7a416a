Return-Path: <git-owner@kernel.org>
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on
	aws-us-west-2-korg-lkml-1.web.codeaurora.org
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by smtp.lore.kernel.org (Postfix) with ESMTP id E6370C64991
	for <git@archiver.kernel.org>; Thu,  1 Sep 2022 13:20:18 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S234217AbiIANUR (ORCPT <rfc822;git@archiver.kernel.org>);
        Thu, 1 Sep 2022 09:20:17 -0400
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:50062 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S233616AbiIANTq (ORCPT <rfc822;git@vger.kernel.org>);
        Thu, 1 Sep 2022 09:19:46 -0400
Received: from mail-wm1-x329.google.com (mail-wm1-x329.google.com [IPv6:2a00:1450:4864:20::329])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 0FA42C53
        for <git@vger.kernel.org>; Thu,  1 Sep 2022 06:17:38 -0700 (PDT)
Received: by mail-wm1-x329.google.com with SMTP id h1so9005216wmd.3
        for <git@vger.kernel.org>; Thu, 01 Sep 2022 06:17:37 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20210112;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:from:to:cc:subject:date;
        bh=DWzbRwGYD5pTW/s8XU+LFnM9Q1gO5VrSXt23Uc0dmDc=;
        b=dZayEMyhOEqwpMbyZc9tuHjhbKmFiUTG08RIsG/gByvhGsE47p/96FD5V5lBIIcfmq
         yfLjS6nw+hXZfeGy+mubOaDaMmiO9mJPYm9EV2OFT6Hm4B5+xHUppOYJEMsSdJRtgeSj
         WxLEQzBbeCjJLdtyrsO9pjuf8L64LLl8H27jPPesOxT3LcgAUcqbG3N1nHe6LW69s3H4
         vEBKJsaeJMmInhh718tkTBGmm4B7+Z3oPnHMsNisfQWzA6pT9eTqsIWXqakcFfrjkEm1
         NoJx0BUsZqKckv8jBwboebOCnmcNjSIO6ngZsBmtnDyeoAysDcZ+1r5mK0aAswwk7k61
         yxPQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20210112;
        h=content-transfer-encoding:mime-version:references:in-reply-to
         :message-id:date:subject:cc:to:from:x-gm-message-state:from:to:cc
         :subject:date;
        bh=DWzbRwGYD5pTW/s8XU+LFnM9Q1gO5VrSXt23Uc0dmDc=;
        b=3OWASMiDBg82bjWxT95aSU+BDH4YHFhwj9g9VjEQvhUOthCTue6lPndmUTNJFTF7Gl
         j+daUR7IZv7xqFcNjb+TdATKLvtHMMjhLw56P/b5QjPm6UUQ+lWnw911xwPbTIzQcdrz
         H8qLUQPYv8OaaZfqx4nScEcnBkPkCm/sDuMYH5AvRhmkJgfSIad+uCOpmd1Kn4eEZCnp
         gsVynCKH7oFUR94XsiY3HMeYYXI4PR2Q6vJGgx+3GbH7e2XE74HtKH+2MuDxVD1dY7n+
         oZkkjMOpra0n/uiOCCahRsqdmBKFrsn+HnRMn/ptwt9bZj+15mHVZR1YOXKsw2nMjNRn
         7nhg==
X-Gm-Message-State: ACgBeo0ixsqReIGwTuOR25LCRfn509L7m8vEpIUJWBRo3hN5d/GldwN9
        exuqZh+VJXUhuVEvcfVinEckoTAmcRrklQ==
X-Google-Smtp-Source: AA6agR4HNDVugu47LutH/aLogtTdTSyQVk+4zo27l+poJHUPDaHQzj1xGdG5V2AQ3Jo25AhA3JxwLA==
X-Received: by 2002:a05:600c:26d2:b0:3a6:280c:24a with SMTP id 18-20020a05600c26d200b003a6280c024amr5118383wmv.130.1662038256292;
        Thu, 01 Sep 2022 06:17:36 -0700 (PDT)
Received: from vm.nix.is (vm.nix.is. [2a01:4f8:120:2468::2])
        by smtp.gmail.com with ESMTPSA id c18-20020adffb52000000b00225239d9265sm14816089wrs.74.2022.09.01.06.17.35
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Thu, 01 Sep 2022 06:17:35 -0700 (PDT)
From:   =?UTF-8?q?=C3=86var=20Arnfj=C3=B6r=C3=B0=20Bjarmason?= 
        <avarab@gmail.com>
To:     git@vger.kernel.org
Cc:     Junio C Hamano <gitster@pobox.com>,
        Johannes Schindelin <Johannes.Schindelin@gmx.de>,
        Victoria Dye <vdye@github.com>,
        =?UTF-8?q?=C3=86var=20Arnfj=C3=B6r=C3=B0=20Bjarmason?= 
        <avarab@gmail.com>
Subject: [PATCH 5/5] Makefile: fix "make clean && make bin-wrappers/$NAME" dependencies
Date:   Thu,  1 Sep 2022 15:17:28 +0200
Message-Id: <patch-5.5-d89e2607077-20220901T130817Z-avarab@gmail.com>
X-Mailer: git-send-email 2.37.3.1426.g360dd7cf8ca
In-Reply-To: <cover-0.5-00000000000-20220901T130817Z-avarab@gmail.com>
References: <sso99so6-n28s-rq86-8q20-4456r3pn869r@tzk.qr> <cover-0.5-00000000000-20220901T130817Z-avarab@gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit
Precedence: bulk
List-ID: <git.vger.kernel.org>
X-Mailing-List: git@vger.kernel.org

The "bin-wrappers/" scripts have never had properly declared
dependency information, i.e. this has never worked:

	make clean &&
	make bin-wrappers/git &&
	./bin-wrappers/git

There was no reason not to have that work, just as most things
generated by the Makefile have proper dependency information.

Before the preceding commits doing this would have been painful, but
now it's quite easy to simply make use of the third parameter to our
"bin_wrappers_template"

Signed-off-by: Ævar Arnfjörð Bjarmason <avarab@gmail.com>
---
 Makefile | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/Makefile b/Makefile
index 533858ca481..07a9901c99d 100644
--- a/Makefile
+++ b/Makefile
@@ -3075,9 +3075,10 @@ define bin_wrappers_template
 BW_$(1) = $$($(1):%=bin-wrappers/%)
 BIN_WRAPPERS += $$(BW_$(1))
 all:: $$(BW_$(1))
+$$(BW_$(1)): bin-wrappers/% : $(3)%$(4)
 $$(BW_$(1)): wrap-for-bin.sh
 	$$(call mkdir_p_parent_template)
-	$$(QUIET_GEN)$$(call cmd_munge_bin_wrappers_script,$(2),$(3))
+	$$(QUIET_GEN)$$(call cmd_munge_bin_wrappers_script,$(2),$(3),$(4))
 endef
 
 $(eval $(call bin_wrappers_template,BINDIR_PROGRAMS_NEED_X,'$$(@F)',,$$X))
-- 
2.37.3.1426.g360dd7cf8ca

