Return-Path: <git-owner@vger.kernel.org>
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on
	aws-us-west-2-korg-lkml-1.web.codeaurora.org
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by smtp.lore.kernel.org (Postfix) with ESMTP id 3231DC7618E
	for <git@archiver.kernel.org>; Fri, 21 Apr 2023 23:34:31 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S231614AbjDUXe3 (ORCPT <rfc822;git@archiver.kernel.org>);
        Fri, 21 Apr 2023 19:34:29 -0400
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:37152 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S229592AbjDUXe2 (ORCPT <rfc822;git@vger.kernel.org>);
        Fri, 21 Apr 2023 19:34:28 -0400
Received: from mail-pf1-x429.google.com (mail-pf1-x429.google.com [IPv6:2607:f8b0:4864:20::429])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id D74272128
        for <git@vger.kernel.org>; Fri, 21 Apr 2023 16:34:26 -0700 (PDT)
Received: by mail-pf1-x429.google.com with SMTP id d2e1a72fcca58-63b67a26069so3769925b3a.0
        for <git@vger.kernel.org>; Fri, 21 Apr 2023 16:34:26 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20221208; t=1682120066; x=1684712066;
        h=mime-version:user-agent:message-id:in-reply-to:date:references
         :subject:cc:to:from:sender:from:to:cc:subject:date:message-id
         :reply-to;
        bh=pV4UyrjQ5Lnc0sybWLNa56W76nk87hTyzdcly7336ak=;
        b=my3OI3GzS1fDTCqwwCqz6v0NVBcol/pjFa65GddnvWsMCVik+OG8NJfRyCcGC42yYo
         gzhyzgQR2YlABUkRSL4UiE8PqB+zJ33ciBUiOUXAWJHMBaeu2Hv2Wx5Po1PMZY3mccHz
         UND3JA3snw4TbokchzhBxaW3LxmhaO63llh3rOf8ECgXsiHnNBT8n7ToNgKzN22NPnuu
         ZocazAYobiC6fv9JJ7mxBSSy5aXwOcTzwWpQQ+HF8wjzhWuBrKmAowJZipbP2pVEh0wY
         nW9iiVPmOKZVTNKVD1LrrEcjU2K6wU3obhL2HKzmTz2YJnwdlT3WvZdntGH9O7pd8jxs
         VXug==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20221208; t=1682120066; x=1684712066;
        h=mime-version:user-agent:message-id:in-reply-to:date:references
         :subject:cc:to:from:sender:x-gm-message-state:from:to:cc:subject
         :date:message-id:reply-to;
        bh=pV4UyrjQ5Lnc0sybWLNa56W76nk87hTyzdcly7336ak=;
        b=SZrD+NFw4Gu38eW9Icg3F/nM0L1WRcv0LP0ZO4O/LzU7t5BP32cn+G1TDzsZqKp/8z
         e7A7voxS8Ufh7yxlGCzZaDEBG9JeyOg9HQxuZZ+FJRgnIFGge57XUe8ijemuQCjYGeCY
         aOONbR9Bj8V5K2Q5HAS63umsRp5/ffzwovhjyqTRV0tngqWo3KwyXQ5SjnD4FExMU20t
         pJ12lFNOViTz7L5P4e/bt2bSl7GpZtmVChoSJG+Qviw7XhDA6aO7/M/ESpuGmjIc6jZy
         2wP9aGKyfpt8EgI4NwA8IXdseXQ4325xX61lA/bpbfKzFIpxmqCewV2XM0m5rp8Z6LP3
         iMkg==
X-Gm-Message-State: AAQBX9d2S6oG6vuEfzW/Stg17SfugUbZ7vtUL+//ue2Ilhh0cOBEGVUh
        vSPgrK7PxVJC3D9zO3i4oAk=
X-Google-Smtp-Source: AKy350a0YgZSW3slYgQdZ+3PmK2wuvBsJ5f0KD/Xy3AM5t1brO9KRzVcEd+n4YeSHKr/EKEM69iF7w==
X-Received: by 2002:a05:6a21:100e:b0:f1:8f7:eeb5 with SMTP id nk14-20020a056a21100e00b000f108f7eeb5mr7266644pzb.60.1682120065723;
        Fri, 21 Apr 2023 16:34:25 -0700 (PDT)
Received: from localhost (187.137.203.35.bc.googleusercontent.com. [35.203.137.187])
        by smtp.gmail.com with ESMTPSA id s23-20020a62e717000000b005aa60d8545esm3489224pfh.61.2023.04.21.16.34.25
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Fri, 21 Apr 2023 16:34:25 -0700 (PDT)
Sender: Junio C Hamano <jch2355@gmail.com>
From:   Junio C Hamano <gitster@pobox.com>
To:     Jacob Keller <jacob.e.keller@intel.com>
Cc:     git@vger.kernel.org, Jacob Keller <jacob.keller@gmail.com>,
        Glen Choo <chooglen@google.com>
Subject: Re: [PATCH] blame: use different author name for fake commit
 generated by --contents
References: <20230421223013.467142-1-jacob.e.keller@intel.com>
Date:   Fri, 21 Apr 2023 16:34:24 -0700
In-Reply-To: <20230421223013.467142-1-jacob.e.keller@intel.com> (Jacob
        Keller's message of "Fri, 21 Apr 2023 15:30:13 -0700")
Message-ID: <xmqqbkjgizcv.fsf@gitster.g>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/28.2 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain
Precedence: bulk
List-ID: <git.vger.kernel.org>
X-Mailing-List: git@vger.kernel.org

Jacob Keller <jacob.e.keller@intel.com> writes:

> +test_expect_success 'blame working copy' '
> +	test_when_finished "git restore file" &&
> +	echo "1A quick brown fox jumps over" >file &&
> +	echo "another lazy dog" >> file &&

Lose the SP between ">>" redirection operator and its operand
"file".

So, we have "1A quick brown fox jumps over the" and "lazy dog"
in :file and HEAD:file, and both of these lines are different
in the working tree files as shown above.

> +	check_count A 1 "Not Committed Yet" 1

So why do we expect one is attributed to A while the other is
attributed to the working tree file?  Shouldn't we be expecting both
to be attributed to "Not Committed Yet"?

WIth this updated like the attached, 8001, 8002, and 8012 seem to
all pass (and without, they all fail).

 t/annotate-tests.sh | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git c/t/annotate-tests.sh w/t/annotate-tests.sh
index 859693949b..4238ce45f8 100644
--- c/t/annotate-tests.sh
+++ w/t/annotate-tests.sh
@@ -74,8 +74,8 @@ test_expect_success 'blame 1 author' '
 
 test_expect_success 'blame working copy' '
 	test_when_finished "git restore file" &&
-	echo "1A quick brown fox jumps over" >file &&
-	echo "another lazy dog" >> file &&
+	echo "11A quick brown fox jumps over the" >file &&
+	echo "lazy dog" >>file &&
 	check_count A 1 "Not Committed Yet" 1
 '
 


