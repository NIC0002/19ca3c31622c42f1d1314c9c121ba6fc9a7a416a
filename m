Return-Path: <git-owner@vger.kernel.org>
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on
	aws-us-west-2-korg-lkml-1.web.codeaurora.org
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by smtp.lore.kernel.org (Postfix) with ESMTP id E7AEAC77B75
	for <git@archiver.kernel.org>; Tue, 18 Apr 2023 04:41:47 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S229604AbjDRElq (ORCPT <rfc822;git@archiver.kernel.org>);
        Tue, 18 Apr 2023 00:41:46 -0400
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:43062 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S229516AbjDRElp (ORCPT <rfc822;git@vger.kernel.org>);
        Tue, 18 Apr 2023 00:41:45 -0400
Received: from cloud.peff.net (cloud.peff.net [104.130.231.41])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id A702D1BDC
        for <git@vger.kernel.org>; Mon, 17 Apr 2023 21:41:43 -0700 (PDT)
Received: (qmail 745 invoked by uid 109); 18 Apr 2023 04:41:43 -0000
Received: from Unknown (HELO peff.net) (10.0.1.2)
 by cloud.peff.net (qpsmtpd/0.94) with ESMTP; Tue, 18 Apr 2023 04:41:43 +0000
Authentication-Results: cloud.peff.net; auth=none
Received: (qmail 30664 invoked by uid 111); 18 Apr 2023 04:41:42 -0000
Received: from coredump.intra.peff.net (HELO sigill.intra.peff.net) (10.0.0.2)
 by peff.net (qpsmtpd/0.94) with (TLS_AES_256_GCM_SHA384 encrypted) ESMTPS; Tue, 18 Apr 2023 00:41:42 -0400
Authentication-Results: peff.net; auth=none
Date:   Tue, 18 Apr 2023 00:41:42 -0400
From:   Jeff King <peff@peff.net>
To:     Felipe Contreras <felipe.contreras@gmail.com>
Cc:     git@vger.kernel.org, Junio C Hamano <gitster@pobox.com>,
        Martin =?utf-8?B?w4VncmVu?= <martin.agren@gmail.com>
Subject: Re: [PATCH] doc: remove custom callouts format
Message-ID: <20230418044142.GA130759@coredump.intra.peff.net>
References: <20230418011828.47851-1-felipe.contreras@gmail.com>
 <20230418040034.GC60552@coredump.intra.peff.net>
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Disposition: inline
In-Reply-To: <20230418040034.GC60552@coredump.intra.peff.net>
Precedence: bulk
List-ID: <git.vger.kernel.org>
X-Mailing-List: git@vger.kernel.org

On Tue, Apr 18, 2023 at 12:00:34AM -0400, Jeff King wrote:

> It's probably still worth moving forward with your patch, as I think it
> takes us in the direction we want long-term (and which builds with
> asciidoctor are already using). But we may want to pair it with a patch
> to work around the issue with git-checkout.1 using asciidoc to avoid
> regressing that section. It may require re-wording or re-organizing to
> work around the bug.

Just to clarify my comment on asciidoctor: since our Makefile will put
its output through docbook, too, it actually is using the xsl you're
removing here (though I'm unclear on why its output looks good in
general even before your patch).

But the problem with git-checkout.1 in particular is that the XML
generated by asciidoc does not close the <calloutlist> at the right spot
(it sticks the continuation onto the calloutlist), whereas asciidoctor
does it right (it closes the calloutlist after item 3).

I had tried putting an open block around the whole example and callout
list before, which asciidoc doesn't like. But doing it just around the
callout list, like so:

diff --git a/Documentation/git-checkout.txt b/Documentation/git-checkout.txt
index 6bb32ab460..bd83a6e5d2 100644
--- a/Documentation/git-checkout.txt
+++ b/Documentation/git-checkout.txt
@@ -530,9 +530,11 @@ $ rm -f hello.c
 $ git checkout hello.c            <3>
 ------------
 +
+--
 <1> switch branch
 <2> take a file out of another commit
 <3> restore `hello.c` from the index
+--
 +
 If you want to check out _all_ C source files out of the index,
 you can say

seems to improve things. The generated XML looks sensible, and the
output looks like asciidoctor's, though unfortunately both omit the
blank line between the end of the callout list and the next paragraph.
That might be good enough to live with.

-Peff
