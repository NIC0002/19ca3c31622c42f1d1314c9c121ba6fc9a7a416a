Return-Path: <git-owner@kernel.org>
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on
	aws-us-west-2-korg-lkml-1.web.codeaurora.org
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by smtp.lore.kernel.org (Postfix) with ESMTP id C1E63C433F5
	for <git@archiver.kernel.org>; Thu,  7 Apr 2022 22:43:18 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S232281AbiDGWpR (ORCPT <rfc822;git@archiver.kernel.org>);
        Thu, 7 Apr 2022 18:45:17 -0400
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:37414 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S232297AbiDGWpO (ORCPT <rfc822;git@vger.kernel.org>);
        Thu, 7 Apr 2022 18:45:14 -0400
Received: from pb-smtp1.pobox.com (pb-smtp1.pobox.com [64.147.108.70])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 8F89C154715
        for <git@vger.kernel.org>; Thu,  7 Apr 2022 15:43:12 -0700 (PDT)
Received: from pb-smtp1.pobox.com (unknown [127.0.0.1])
        by pb-smtp1.pobox.com (Postfix) with ESMTP id 6609810D827;
        Thu,  7 Apr 2022 18:43:11 -0400 (EDT)
        (envelope-from junio@pobox.com)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed; d=pobox.com; h=from:to:cc
        :subject:references:date:in-reply-to:message-id:mime-version
        :content-type; s=sasl; bh=JIQiLXVZmtETJk5TlpjxuVfKLzq6hCQgenl3gH
        qxLlY=; b=pi91ZIRDQ+rC0OE1NSxZwL3JLHNURkIHe9Y35hzoR2VDfXjPsDGrrg
        oTG9k17R5ilopbW6ELx0JeHYojF8alrN/Vx+K+URchMpKceSLH0h4XRq+uCvrg0G
        NV1Qqr3Z3GT+7aNfRR8IR8VYr/BCaNlOyGZDduC5rQKkkY0CCfkkE=
Received: from pb-smtp1.nyi.icgroup.com (unknown [127.0.0.1])
        by pb-smtp1.pobox.com (Postfix) with ESMTP id 5D29910D825;
        Thu,  7 Apr 2022 18:43:11 -0400 (EDT)
        (envelope-from junio@pobox.com)
Received: from pobox.com (unknown [35.230.65.123])
        (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
        (No client certificate requested)
        by pb-smtp1.pobox.com (Postfix) with ESMTPSA id C95B010D821;
        Thu,  7 Apr 2022 18:43:10 -0400 (EDT)
        (envelope-from junio@pobox.com)
From:   Junio C Hamano <gitster@pobox.com>
To:     Johannes Schindelin <Johannes.Schindelin@gmx.de>
Cc:     Danny Lin <danny0838@gmail.com>, git develop <git@vger.kernel.org>
Subject: Re: [PATCH] git-prompt: fix sequencer/todo detection
References: <20220325145301.3370-1-danny0838@gmail.com>
        <xmqqwngdzque.fsf@gitster.g>
        <nycvar.QRO.7.76.6.2204072315330.347@tvgsbejvaqbjf.bet>
Date:   Thu, 07 Apr 2022 15:43:09 -0700
In-Reply-To: <nycvar.QRO.7.76.6.2204072315330.347@tvgsbejvaqbjf.bet> (Johannes
        Schindelin's message of "Thu, 7 Apr 2022 23:45:20 +0200 (CEST)")
Message-ID: <xmqq7d80qzuq.fsf@gitster.g>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/27.2 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain
X-Pobox-Relay-ID: 1A0AA536-B6C4-11EC-8016-5E84C8D8090B-77302942!pb-smtp1.pobox.com
Precedence: bulk
List-ID: <git.vger.kernel.org>
X-Mailing-List: git@vger.kernel.org

Johannes Schindelin <Johannes.Schindelin@gmx.de> writes:

>> > diff --git a/contrib/completion/git-prompt.sh b/contrib/completion/git-prompt.sh
>> > index db7c0068fb..8ae341a306 100644
>> > --- a/contrib/completion/git-prompt.sh
>> > +++ b/contrib/completion/git-prompt.sh
>> > @@ -315,7 +315,7 @@ __git_sequencer_status ()
>> >  	elif __git_eread "$g/sequencer/todo" todo
>> >  	then
>> >  		case "$todo" in
>> > -		p[\ \	]|pick[\ \	]*)
>> > +		p[\ \	]*|pick[\ \	]*)
>> >  			r="|CHERRY-PICKING"
>> >  			return 0
>> >  		;;
>> ...
>
> It looks to me as if the abbreviated commands cannot be generated by Git
> (the `replay_opts` in `builtin/revert.c` are all initialized to
> `REPLAY_OPTS_INIT`, so there is not even any chance of uninitialized data
> there).

Good.  Then the right "fix" would be to drop the misleading "We
would also accept the abbreviated" side of the case arm, instead of
fixing "if we were generating the abbreviated one, here is how we
might support it" code, I guess.

Thanks for sanity-checking my digging in the sequencer.c code.


